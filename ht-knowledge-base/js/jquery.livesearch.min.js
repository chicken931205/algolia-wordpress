/***
@title:
Live Search

@version:
2.0

@author:
Andreas Lagerkvist

@date:
2008-08-31

@url:
http://andreaslagerkvist.com/jquery/live-search/

@license:
http://creativecommons.org/licenses/by/3.0/

@copyright:
2008 Andreas Lagerkvist (andreaslagerkvist.com)

@requires:
jquery, jquery.liveSearch.css

@does:
Use this plug-in to turn a normal form-input in to a live ajax search widget. The plug-in displays any HTML you like in the results and the search-results are updated live as the user types.

@howto:
jQuery('#q').liveSearch({url: '/ajax/search.php?q='}); would add the live-search container next to the input#q element and fill it with the contents of /ajax/search.php?q=THE-INPUTS-VALUE onkeyup of the input.

@exampleHTML:
<form method="post" action="/search/">

	<p>
		<label>
			Enter search terms<br />
			<input type="text" name="q" />
		</label> <input type="submit" value="Go" />
	</p>

</form>

@exampleJS:
jQuery('#jquery-live-search-example input[name="q"]').liveSearch({url: Router.urlForModule('SearchResults') + '&q='});
***/
jQuery.fn.liveSearch=function(t){var e=jQuery.extend({url:"/search-results.php?q=",id:"jquery-live-search",duration:400,typeDelay:200,triggerLength:4,loadingClass:"live-search-loading",onSlideUp:function(){},onShowLiveSearch:function(){},uptadePosition:!1,keepTypingPrompt:"keep typing"},t),i=jQuery("#"+e.id);return i.length||(i=jQuery('<div id="'+e.id+'"></div>').appendTo(document.body).hide().slideUp(0),jQuery(document.body).click((function(t){var a=jQuery(t.target);a.is("#"+e.id)||a.parents("#"+e.id).length||a.is("input")||i.slideUp(e.duration,(function(){e.onSlideUp()}))}))),this.each((function(){jQuery(this).bind("hideLiveSearch",(function(){s()}));var t=jQuery(this).attr("autocomplete","off"),a=parseInt(i.css("paddingLeft"),10)+parseInt(i.css("paddingRight"),10)+parseInt(i.css("borderLeftWidth"),10)+parseInt(i.css("borderRightWidth"),10),n=function(){var e=t.offset(),n={left:e.left,top:e.top,width:t.outerWidth(),height:t.outerHeight()};n.topPos=n.top+n.height,n.totalWidth=n.width-a,i.css({position:"absolute",left:n.left+"px",top:n.topPos+"px",width:n.totalWidth+"px"})},r=function(){t.attr("aria-expanded","true"),jQuery(this).attr("aria-expanded","true"),jQuery("#s").attr("aria-expanded","true"),n(),jQuery(window).unbind("resize",n),jQuery(window).bind("resize",n),e.onShowLiveSearch(),i.slideDown(e.duration)},s=function(){i.slideUp(e.duration,(function(){e.onSlideUp(),t.attr("aria-expanded","false"),jQuery(this).attr("aria-expanded","false"),jQuery("#s").attr("aria-expanded","false")}))};t.focus((function(){""!==this.value&&(""===i.html()?(this.lastValue="",t.keyup()):setTimeout(r,1))})).keyup((function(){if(0==this.value.length)return this.timer&&clearTimeout(this.timer),s(),void(this.lastValue=this.value);if(this.value.length<=e.triggerLength)return this.timer&&clearTimeout(this.timer),i.html(e.keepTypingPrompt),r(),void(this.lastValue=this.value);if(this.value!=this.lastValue){t.addClass(e.loadingClass);var a=encodeURIComponent(this.value);this.timer&&clearTimeout(this.timer),this.timer=setTimeout((function(){jQuery.get(e.url+a,(function(n){t.removeClass(e.loadingClass),n.length&&a.length?(i.html(n),r()):s()}))}),e.typeDelay),this.lastValue=this.value}}))}))};