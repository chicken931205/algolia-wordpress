/***
@title:
Live Search

@version:
2.0

@author:
Andreas Lagerkvist

@date:
2008-08-31

@url:
http://andreaslagerkvist.com/jquery/live-search/

@license:
http://creativecommons.org/licenses/by/3.0/

@copyright:
2008 Andreas Lagerkvist (andreaslagerkvist.com)

@requires:
jquery, jquery.liveSearch.css

@does:
Use this plug-in to turn a normal form-input in to a live ajax search widget. The plug-in displays any HTML you like in the results and the search-results are updated live as the user types.

@howto:
jQuery('#q').liveSearch({url: '/ajax/search.php?q='}); would add the live-search container next to the input#q element and fill it with the contents of /ajax/search.php?q=THE-INPUTS-VALUE onkeyup of the input.

@exampleHTML:
<form method="post" action="/search/">

	<p>
		<label>
			Enter search terms<br />
			<input type="text" name="q" />
		</label> <input type="submit" value="Go" />
	</p>

</form>

@exampleJS:
jQuery('#jquery-live-search-example input[name="q"]').liveSearch({url: Router.urlForModule('SearchResults') + '&q='});
***/
jQuery.fn.liveSearch=function(t){var e=jQuery.extend({url:"/search-results.php?q=",id:"jquery-live-search",duration:400,typeDelay:200,triggerLength:4,loadingClass:"live-search-loading",onSlideUp:function(){},onShowLiveSearch:function(){},uptadePosition:!1,keepTypingPrompt:"keep typing"},t),i=jQuery("#"+e.id);return i.length||(i=jQuery('<div id="'+e.id+'"></div>').appendTo(document.body).hide().slideUp(0),jQuery(document.body).click((function(t){var a=jQuery(t.target);a.is("#"+e.id)||a.parents("#"+e.id).length||a.is("input")||i.slideUp(e.duration,(function(){e.onSlideUp()}))}))),this.each((function(){jQuery(this).bind("hideLiveSearch",(function(){s()}));var t=jQuery(this).attr("autocomplete","off"),a=parseInt(i.css("paddingLeft"),10)+parseInt(i.css("paddingRight"),10)+parseInt(i.css("borderLeftWidth"),10)+parseInt(i.css("borderRightWidth"),10),n=function(){var e=t.offset(),n={left:e.left,top:e.top,width:t.outerWidth(),height:t.outerHeight()};n.topPos=n.top+n.height,n.totalWidth=n.width-a,i.css({position:"absolute",left:n.left+"px",top:n.topPos+"px",width:n.totalWidth+"px"})},r=function(){t.attr("aria-expanded","true"),jQuery(this).attr("aria-expanded","true"),jQuery("#s").attr("aria-expanded","true"),n(),jQuery(window).unbind("resize",n),jQuery(window).bind("resize",n),e.onShowLiveSearch(),i.slideDown(e.duration)},s=function(){i.slideUp(e.duration,(function(){e.onSlideUp(),t.attr("aria-expanded","false"),jQuery(this).attr("aria-expanded","false"),jQuery("#s").attr("aria-expanded","false")}))};t.focus((function(){""!==this.value&&(""===i.html()?(this.lastValue="",t.keyup()):setTimeout(r,1))})).keyup((function(){if(0==this.value.length)return this.timer&&clearTimeout(this.timer),s(),void(this.lastValue=this.value);if(this.value.length<=e.triggerLength)return this.timer&&clearTimeout(this.timer),i.html(e.keepTypingPrompt),r(),void(this.lastValue=this.value);if(this.value!=this.lastValue){t.addClass(e.loadingClass);var a=encodeURIComponent(this.value);this.timer&&clearTimeout(this.timer),this.timer=setTimeout((function(){jQuery.get(e.url+a,(function(n){t.removeClass(e.loadingClass),n.length&&a.length?(i.html(n),r()):s()}))}),e.typeDelay),this.lastValue=this.value}}))}))},jQuery(document).ready((function(t){"use strict";var e=window.hkbJSSettings,i="hkb-jquery-live-search",a=t(".hkb-site-search__field").liveSearch({url:e.liveSearchUrl,keepTypingPrompt:e.keepTypingPrompt,id:i,onShowLiveSearch:o,triggerLength:e.triggerLength}),n=".hkb-searchresults",r=null,s=a.parents("form"),o=function(){null!=r&&r.removeClass("hkb-searchresults__current")};function l(){var e=t("#"+i),r=e.offset().top,s=e.height(),o=r+s,l=(a.height(),t(n).find("li.hkb-searchresults__current")),h=null;h=void 0===l||void 0===(h=l.offset())?0:h.top;var u=null;u=void 0===l?0:l.height();var d=null;d=void 0===l?0:l.index();var c=u+h,p=e.scrollTop(),f=t(n).children("li").length;0!==d?d+1!=f?c>o?e.scrollTop(p+u):h<r&&e.scrollTop(p-u):e.scrollTop(s+2*u):e.scrollTop(0)}a.bind("keydown",(function(e){switch(e.keyCode){case 9:return;case 40:e.preventDefault(),e.stopPropagation(),t(n).css("display","block"),null===r||r.length<=0?r=t(n).find("li").first().addClass("hkb-searchresults__current"):(o(),r=r.next("li").length<=0?t(n).find("li").first().addClass("hkb-searchresults__current"):r.next("li").addClass("hkb-searchresults__current")),l();break;case 38:e.preventDefault(),e.stopPropagation(),null===r||r.length<=0?r=t(n).find("li").last().addClass("hkb-searchresults__current"):(o(),r=r.prev("li").length<=0?t(n).find("li").last().addClass("hkb-searchresults__current"):r.prev("li").addClass("hkb-searchresults__current")),l();break;case 13:if(t(n).find(".current").length>0&&(r=t(n).find(".hkb-searchresults__current")),null!==r&&r.length>0){e.preventDefault(),e.stopPropagation();var i=r.find("a").first().attr("href");t(".hkb-searchresults").hide(),o(),r=null,window.location.href=i;break}s.first().submit();break;case 27:a.trigger("hideLiveSearch")}})),e.focusSearchBox&&(window.location.hash||jQuery(".hkb-site-search__field").focus())})),jQuery(document).ready((function(t){"use strict";function e(){t(".ht-voting-links a").each((function(i){var a=t(this),n=a.hasClass("enabled"),r=a.attr("data-direction"),s=a.attr("data-type"),o=a.attr("data-nonce"),l=a.attr("data-id"),h=a.attr("data-allow"),u=a.attr("data-display");a.click((function(i){if(i.preventDefault(),n){var a={action:"ht_voting",direction:r,type:s,nonce:o,id:l,allow:h,display:u};t.post(voting.ajaxurl,a,(function(i){var a;""!==i&&("post"==s?(t("#ht-voting-post-"+l).replaceWith(i),(a=t("#ht-voting-post-"+l).find(".ht-voting-comment").first()).hide(),a.slideDown(500,(function(){a.find("textarea").focus()}))):"comment"==s&&(t("#ht-voting-comment-"+l).slideUp(500),t("#ht-voting-comment-"+l).replaceWith(i),t("#ht-voting-comment-"+l).slideDown(500)),e(),t(".ht-voting-comment").each((function(e){var i=t(this),a=i.attr("data-vote-key"),n=i.hasClass("enabled"),r=i.attr("data-nonce"),s=i.attr("data-id");i.children("button").click((function(e){var o=i.children("textarea").val();if(e.preventDefault(),n){var l={action:"ht_voting_update_feedback",key:a,nonce:r,comment:o,id:s};t.post(voting.ajaxurl,l,(function(t){i.slideUp(500,(function(){""!==t&&i.html(t),i.slideDown(500)}))}))}else{var h=t(".voting-login-required").attr("data-ht-voting-must-log-in-msg");alert(h)}}))})))}))}else{var d=t(".voting-login-required").attr("data-ht-voting-must-log-in-msg");alert(d)}}))}))}e(),window.globalEnablePostVoting=function(){e()}})),jQuery(document).ready((function(t){"use strict";t("a.hkb_widget_exit__btn").each((function(e){var i=t(this),a=i.attr("data-ht-kb-exit-href");i.attr("href",a)}))}));